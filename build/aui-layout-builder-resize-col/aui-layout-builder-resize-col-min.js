YUI.add("aui-layout-builder-resize-col",function(e,t){var n="addColumn",r=[0,1,2,3,4,5,6,7,8,9,10,11,12],i=e.getClassName("layout","builder","resize","col","breakpoint"),s=e.getClassName("layout","builder","resize","col","breakpoint","line"),o=e.getClassName("layout","builder","resize","col","breakpoint","over"),u=e.getClassName("layout","builder","resize","col","draggable"),a=e.getClassName("layout","builder","resize","col","draggable","border"),f=e.getClassName("layout","builder","resize","col","draggable","handle"),l=e.getClassName("layout","builder","resize","col","dragging"),c=e.getClassName("layout","builder","resize","col","enabled"),h=12,p=".layout-row";e.LayoutBuilderResizeCol=function(){},e.LayoutBuilderResizeCol.prototype={TPL_RESIZE_COL_BREAKPOINT:'<div class="'+i+'">'+'<div class="'+s+'" tabindex="8"></div></div>',TPL_RESIZE_COL_DRAGGABLE:'<div class="'+u+'">'+'<div class="'+a+'"></div>'+'<div class="'+f+'" tabindex="8">'+'<span class="glyphicon glyphicon-chevron-left"></span>'+'<span class="glyphicon glyphicon-chevron-right"></span></div></div>',_dragNode:null,_gridlineNodes:[],initializer:function(){this._createDelegateDrag(),this._gridlineNodes=[],this._eventHandles.push(this.after("enableResizeColsChange",this._afterEnableResizeColsChange),this.after("layout:isColumnModeChange",e.bind(this._afterResizeColIsColumnModeChange,this))),this._uiSetEnableResizeCols(this.get("enableResizeCols"))},destructor:function(){this._unbindResizeColEvents(),this._removeGrid()},_afterDragEnd:function(){var t=this._delegateDrag.get("lastNode"),n=t.ancestor(p);n&&(t.getData("layout-action")&&t.getData("layout-action")==="addColumn"?this._insertColumnAfterDropHandles(t):(this._resize(t),this.get("layout").normalizeColsHeight(new e.NodeList(n))),n.removeClass(l),this._hideBreakpoints(n)),this._syncDragHandles(),t.show()},_afterDragEnter:function(e){var t=e.drop.get("node");this._layoutContainer.all("."+o).removeClass(o),t.addClass(o),this._lastDropEnter=t},_afterDragMouseDown:function(e){var t,n;if(e.ev.button>1||!e.target.validClick(e.ev))return;t=e.target.get("node"),n=t.ancestor(p),this._showBreakpoints(n,t)},_afterDragMouseup:function(e){var t=e.target.get("node"),n=t.ancestor(p);n&&this._hideBreakpoints(n)},_afterDragStart:function(e){var t=e.target.get("node");t.hide(),t.ancestor(p).addClass(l)},_afterEnableResizeColsChange:function(){this._uiSetEnableResizeCols(this.get("enableResizeCols"))},_afterResizeColIsColumnModeChange:function(){this._uiSetEnableResizeCols(this.get("enableResizeCols"))},_afterResizeColLayoutChange:function(){this._syncDragHandles(),this._insertGrid()},_afterResizeColLayoutRowsChange:function(){this._syncDragHandles(),this._insertGrid()},_afterResizeColLayoutColsChange:function(){this._syncDragHandles(),this._insertGrid()},_bindResizeColEvents:function(){this._resizeColsEventHandles=[this.after("layoutChange",this._afterResizeColLayoutChange),this.after("layout:rowsChange",this._afterResizeColLayoutRowsChange),this.after("layout-row:colsChange",this._afterResizeColLayoutColsChange),this._delegateDrag.after("drag:end",e.bind(this._afterDragEnd,this)),this._delegateDrag.after("drag:enter",e.bind(this._afterDragEnter,this)),this._delegateDrag.after("drag:mouseDown",e.bind(this._afterDragMouseDown,this)),this._delegateDrag.after("drag:mouseup",e.bind(this._afterDragMouseup,this)),this._delegateDrag.after("drag:start",e.bind(this._afterDragStart,this)),this._layoutContainer.delegate("key",e.bind(this._onKeyPressResizeColDragHandle,this),"press:13","."+u),this._layoutContainer.delegate("key",e.bind(this._onKeyPressResizeColBreakpoint,this),"press:13","."+s)]},_canDrag:function(e){var t;for(t=0;t<r.length;t++)if(r[t]!==e.getData("layout-position")&&this._canDrop(e,r[t]))return!0;return!1},_canDrop:function(e,t){var r=e.getData("layout-col1"),i=e.getData("layout-col2"),s,o,u,a,f=t-e.getData("layout-position");return e.getData("layout-action")===n?i&&f<i.get("size")||r&&h-r.get("size")<t?!0:!1:(u=r.get("size")+f,a=i.get("size")-f,s=r.get("minSize"),o=i.get("minSize"),u!==0&&a!==0&&(u<s||a<o)?!1:!0)},_createDelegateDrag:function(){this._delegateDrag=new e.DD.Delegate({container:this._layoutContainer,handles:["."+f],nodes:"."+u}),this._delegateDrag.dd.plug(e.Plugin.DDConstrained,{constrain:this._layoutContainer,stickX:!0}),this._delegateDrag.dd.plug(e.Plugin.DDProxy,{cloneNode:!0,moveOnEnd:!1})},_handleBreakpointDrop:function(e,t){var n=e.getData("layout-col1"),r=e.getData("layout-col2"),i=t.getData("layout-position")-e.getData("layout-position"),s=n.get("size")+i,o=r.get("size")-i,u;if(!n.get("removable")&&s===0){n.fire("removalCanceled");return}if(!r.get("removable")&&o===0){r.fire("removalCanceled");return}n.set("size",s),r.set("size",o),s===0&&(u=n.get("node").ancestor().getData("layout-row"),u.removeCol(n.get("node").getData("layout-col"))),o===0&&(u=r.get("node").ancestor().getData("layout-row"),u.removeCol(r.get("node").getData("layout-col")))},_hideBreakpoints:function(e){var t=e.all("."+i);t.each(function(e){e.setStyle("display","none")})},_insertColumnAfterDropHandles:function(t){var n=this._lastDropEnter.getData("layout-position"),r=t.getData("layout-position"),i=new e.LayoutCol,s,o=Math.abs(r-n),u=t.ancestor(p).getData("layout-row");r===0?s=0:s=u.get("cols").length,n>0&&n<12&&(i.set("size",o),u.addCol(s,i))},_insertGrid:function(){var t=this,n,i,s=this.get("layout").get("rows");this._removeGrid(),e.each(s,function(s){i=s.get("node").one(p),e.each(r,function(r){n=e.Node.create(t.TPL_RESIZE_COL_BREAKPOINT),n.setStyle("left",r*100/h+"%"),n.setData("layout-position",r),n.plug(e.Plugin.Drop,{padding:"30px"}),i.append(n),t._gridlineNodes.push(n)})})},_onKeyPressResizeColBreakpoint:function(e){var t;this._lastDropEnter=e.target.ancestor("."+i),t=this._lastDropEnter.ancestor(p),this._resize(this._dragNode),t&&this._hideBreakpoints(t),this._syncDragHandles()},_onKeyPressResizeColDragHandle:function(e){var t,n=e.target.ancestor("."+u),r,s=e.target.ancestor(p);this._dragNode=
n,t=s.all("."+i),r=t.filter(function(e){return e.getStyle("display")!=="none"}).size(),r?this._hideBreakpoints(s):this._showBreakpoints(s,n)},_removeDragHandles:function(){this._layoutContainer.all("."+u+":not(.layout-builder-add-col-draggable)").remove()},_removeGrid:function(){this._gridlineNodes.length&&(e.Array.each(this._gridlineNodes,function(t){t.unplug(e.Plugin.Drop),t.remove()}),this._gridlineNodes=[])},_resize:function(e){this._lastDropEnter?(this._handleBreakpointDrop(e,this._lastDropEnter),this._lastDropEnter=null):e.show()},_showBreakpoints:function(e,t){var n=e.all("."+i),r=this;n.each(function(e){r._canDrop(t,e.getData("layout-position"))&&e.setStyle("display","block")})},_syncDragHandles:function(){var t=this;this._removeDragHandles(),e.Array.each(this.get("layout").get("rows"),function(e){t._syncRowDragHandles(e)})},_syncRowDragHandles:function(t){var n=t.get("cols"),r=n.length,i=0,s,o,u=t.get("node").one(p);for(o=0;o<r-1;o++)i+=n[o].get("size"),s=e.Node.create(this.TPL_RESIZE_COL_DRAGGABLE),s.setStyle("left",i*100/h+"%"),s.setData("layout-position",i),s.setData("layout-col1",n[o]),s.setData("layout-col2",n[o+1]),this._canDrag(s)||s.one("."+f).hide(),u.append(s)},_uiSetEnableResizeCols:function(e){e&&this.get("layout").get("isColumnMode")?(this._syncDragHandles(),this._insertGrid(),this._bindResizeColEvents()):(this._removeDragHandles(),this._removeGrid(),this._unbindResizeColEvents()),this.get("container").toggleClass(c,e)},_unbindResizeColEvents:function(){this._resizeColsEventHandles&&(new e.EventHandle(this._resizeColsEventHandles)).detach()}},e.LayoutBuilderResizeCol.ATTRS={enableResizeCols:{validator:e.Lang.isBoolean,value:!0}}},"3.0.3-deprecated.8",{requires:["dd-constrain","dd-delegate","dd-drop-plugin","dd-proxy","event-mouseenter","node-base"],skinnable:!0});
